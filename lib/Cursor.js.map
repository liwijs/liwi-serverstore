{"version":3,"sources":["../src/Cursor.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;qCAA2B,yBAAyB;;;;2CAC9B,+BAA+B;;;;;;;;IAExC,MAAM;cAAN,MAAM;;AACJ,aADF,MAAM,CACH,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE;8BAD3B,MAAM;;AAEX,mCAFK,MAAM,6CAEH;AACR,YAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;AAC1B,YAAI,CAAC,MAAM,GAAG,KAAK,CAAC;AACpB,YAAI,CAAC,MAAM,GAAG,KAAK,CAAC;KACvB;;iBANQ,MAAM;;;;;gCAYR,iBAAC,KAAK,EAAE;AACX,kDAAU,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,EAAE,SAAS,EAAE,KAAK,CAAC,CAAC;AAChE,mBAAO,IAAI,CAAC;SACf;;;;;gCAEG,gBAAG;;;AACH,mBAAO,sCAAU,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC,IAAI,CAAC,UAAC,MAAM,EAAK;AAC1E,sBAAK,OAAO,GAAG,MAAM,CAAC;AACtB,sBAAK,UAAU,GAAG,MAAK,GAAG,GAAG,MAAM,IAAI,MAAM,CAAC,MAAK,MAAM,CAAC,OAAO,CAAC,CAAC;AACnE,uBAAO,MAAK,GAAG,CAAC;aACnB,CAAC,CAAC;SACN;;;;;kCAEK,kBAAG;AACL,mBAAO,SAAQ,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;SACxC;;;;;kCAEK,kBAAG;AACL,mBAAO,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SAC5C;;;;;;mCAEU,qBAAC,QAAQ,EAAE;;;AAClB,gBAAI,OAAO,GAAG,SAAQ,OAAO,EAAE,CAAC;AAChC,kDAAU,EAAE,CAAC,oBAAoB,GAAG,IAAI,CAAC,SAAS,EAAE,UAAC,MAAM,EAAK;AAC5D,oBAAI,CAAC,MAAM,EAAE;AACT,2BAAO,GAAG,OAAO,CAAC,IAAI,CAAC;+BAAM,OAAK,KAAK,EAAE;qBAAA,CAAC,CAAC;AAC3C,2BAAO;iBACV;;AAED,uBAAO,GAAG,OAAO,CAAC,IAAI,CAAC,YAAM;AACzB,2BAAK,OAAO,GAAG,MAAM,CAAC;AACtB,2BAAK,UAAU,GAAG,OAAK,GAAG,GAAG,MAAM,IAAI,MAAM,CAAC,OAAK,MAAM,CAAC,OAAO,CAAC,CAAC;AACnE,2BAAO,QAAQ,CAAC,OAAK,GAAG,CAAC,CAAC;iBAC7B,CAAC,CAAC;aACN,CAAC,CAAC;;AAEH,mBAAO,sCAAU,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC,IAAI,CAAC,YAAM;AACvE,sDAAU,GAAG,CAAC,oBAAoB,GAAG,OAAK,SAAS,CAAC,CAAC;AACrD,uBAAO,OAAO,CAAC;aAClB,CAAC,CAAC;SACN;;;;;iCAEI,iBAAG;;;AACJ,mBAAO,sCAAU,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC,IAAI,CAAC,YAAM;AACrE,uBAAK,OAAO,GAAG,OAAK,MAAM,GAAG,OAAK,SAAS,GAAG,SAAS,CAAC;aAC3D,CAAC,CAAC;SACN;;;;;+BAlDQ,eAAG;AACR,mBAAO,IAAI,CAAC,MAAM,CAAC;SACtB;;;WAVQ,MAAM","file":"Cursor.js","sourcesContent":["import AbstractCursor from 'liwi/lib/AbstractCursor';\nimport webSocket from 'springbokjs-browser/webSocket';\n\nexport class Cursor extends AbstractCursor {\n    constructor(idCursor, store, query) {\n        super();\n        this._idCursor = idCursor;\n        this._store = store;\n        this._query = query;\n    }\n\n    get query() {\n        return this._query;\n    }\n\n    advance(count) {\n        webSocket.emit('db cursor ' + this._idCursor, 'advance', count);\n        return this;\n    }\n\n    next() {\n        return webSocket.emit('db cursor ' + this._idCursor, 'next').then((result) => {\n            this._result = result;\n            this.primaryKey = this.key = result && result[this._store.keyPath];\n            return this.key;\n        });\n    }\n\n    result() {\n        return Promise.resolve(this._result);\n    }\n\n    remove() {\n        return this._store.deleteByKey(this.key);\n    }\n\n    forEachKeys(callback) {\n        let promise = Promise.resolve();\n        webSocket.on('db cursor forEach ' + this._idCursor, (result) => {\n            if (!result) {\n                promise = promise.then(() => this.close());\n                return;\n            }\n\n            promise = promise.then(() => {\n                this._result = result;\n                this.primaryKey = this.key = result && result[this._store.keyPath];\n                return callback(this.key);\n            });\n        });\n\n        return webSocket.emit('db cursor ' + this._idCursor, 'forEach').then(() => {\n            webSocket.off('db cursor forEach ' + this._idCursor);\n            return promise;\n        });\n    }\n\n    close() {\n        return webSocket.emit('db cursor ' + this._idCursor, 'close').then(() => {\n            this._result = this._store = this._idCursor = undefined;\n        });\n    }\n}\n"]}